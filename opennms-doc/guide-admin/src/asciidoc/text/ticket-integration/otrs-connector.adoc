
[[ticket-integration-otrs31connector]]
== OTRS connector

The _OTRS connector_ allows one to create and manage _OTRS_ tickets from _OpenNMS_ alarms.

When integration is enabled, three new buttons get displayed on the _Alarm Details_ page:

* _Create ticket_: Create a ticket from this alarm instance in _OTRS_
* _Update ticket_: Update the ticket status from an existing ticket in _OTRS_
* _Close ticket_: Close a ticket based on this alarm instance in _OTRS_

The alarm state is synchronized with the corresponding ticket state in _OTRS_.
A ticket can be closed either from _OTRS_ or _OpenNMS_, its state will be reflected on the other side.
Also, buttons are activated/deactivated accordingly.

=== Compatibility

The connector documented here is implemented via the `org.opennms.netmgt.ticketer.otrs31.Otrs31TicketerPlugin` and is compatible with  _OTRS 3.1_ and above.

A previous implementation of this connector,  `org.opennms.netmgt.ticketer.otrs.OtrsTicketerPlugin`, +
is compatible with _OTRS 3.0_ and lower. This implementation is documented on http://www.opennms.org/wiki/OTRS[the wiki]

=== Configuration

Configuration of the OTRS connector occurs via the 'opennms.properties' and 'otrs.properties' files.
The table below describes the configuration parameters of the 'opennms.properties' file related to the configuration of OpenNMS' ticket integration.

[options="header, autowidth"]
|===
| Parameter                                 | Description                                                     | Required | Default value
| `opennms.ticketer.plugin`                 | Defines the ticket integration connector to be used. To use 
                                              this _OTRS_ ticket integration connector specify
                                              `org.opennms.netmgt.ticketer.otrs31.Otrs31TicketerPlugin`       | required | `org.opennms.netmgt.ticketd.NullTicketerPlugin`
| `opennms.alarmTroubleTicketLinkTemplate`  | Defines how links to the ticketing systems will be constructed. |          | `none`
| `opennms.alarmTroubleTicketEnabled`       | When set to `true`, enables ticket integration.                 | optional | `false`
|===

The table below describes the various configuration parameters of the 'otrs.properties' file.

[options="header, autowidth"]
|===
| Parameter                     | Description                                                           | Required | Default value
| `otrs.endpoint`               | URI where _OpenNMS_ should contact the _OTRS_ ticketing system.       | required | `http://localhost/otrs/nph-genericinterface.pl/Webservice/GenericTicketConnector`
| `otrs.username`               | Username to use for _OTRS_ endpoint authentication                    | required | `ticketer@localhost`
| `otrs.password`               | Password to use for _OTRS_ endpoint authentication                    | required | `1ticketer!`
| `otrs.state`                  |                                                                       | optional | `new`
| `otrs.priority`               |                                                                       | optional | `3 normal`
| `otrs.queue`                  |                                                                       | optional | `Raw`
| `otrs.defaultuser`            |                                                                       |          | `customer@localhost`
| `otrs.ownerid`                | Not used by this implementation.                                      |          | `1`
| `otrs.lock`                   | Not used by this implementation.                                      |          | `unlock`
| `otrs.articlefrom`            | Not used by this implementation.                                      |          | `customer`
| `otrs.articletype`            |                                                                       |          | `note-external`
| `otrs.articlesendertype`      |                                                                       |          | `agent`
| `otrs.articlecontenttype`     |                                                                       |          | `text/plain; charset=ISO-8859-15`
| `otrs.articlehistorycomment`  |                                                                       |          | `update by OpenNMS`
| `otrs.articlehistorytype`     |                                                                       |          | `OwnerUpdate`
| `otrs.validopenstateid`       |                                                                       |          | ``
| `otrs.validclosedstateid`     |                                                                       |          | ``
| `otrs.validcancelledstateid`  |                                                                       |          | ``
| `otrs.openstateid`            |                                                                       |          | ``
| `otrs.closedstateid`          |                                                                       |          | ``
| `otrs.cancelledstateid`       |                                                                       |          | ``
| `otrs.articleupdatesubject`   |                                                                       |          | `Ticket update by OpenNMS`
| `otrs.ticketopenedmessage`    |                                                                       |          | `Ticket opened by OpenNMS`
| `otrs.ticketclosedmessage`    |                                                                       |          | `Ticket closed by OpenNMS`
| `otrs.ticketcancelledmessage` |                                                                       |          | `Ticket cancelled by OpenNMS`
| `otrs.ticketupdatedmessage`   |                                                                       |          | `Ticket updated by OpenNMS`
|===
